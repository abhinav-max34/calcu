const API_TOKEN = "YOUR_API_TOKEN_HERE";

function level(aqi){
  if(aqi<=50) return ["Good","good"];
  if(aqi<=100) return ["Moderate","moderate"];
  if(aqi<=200) return ["Poor","poor"];
  if(aqi<=300) return ["Bad","bad"];
  return ["Severe","severe"];
}

async function fetchCityAQI(){
  const city = document.getElementById("cityInput").value;
  const r = await fetch(`https://api.waqi.info/feed/${city}/?token=${API_TOKEN}`);
  const d = await r.json();
  if(d.status!=="ok") return;
  const aqi = d.data.aqi;
  const [t,c] = level(aqi);
  document.getElementById("cityResult").innerHTML =
    `<div class="aqiBox ${c}">${city}<br>AQI:${aqi}<br>${t}</div>`;
  saveHistory(city, aqi);
}

async function loadVillageAQI(){
  const box = document.getElementById("villageAQI");
  for(let v of villages){
    const r = await fetch(`https://api.waqi.info/feed/geo:${v.lat};${v.lon}/?token=${API_TOKEN}`);
    const d = await r.json();
    if(d.status!=="ok") continue;
    const aqi = d.data.aqi;
    const [t,c] = level(aqi);
    box.innerHTML += `<div class="aqiBox ${c}">${v.name}<br>AQI:${aqi}<br>${t}</div>`;
    saveHistory(v.name, aqi);
  }
}

window.onload = ()=>{
  loadVillageAQI();
  loadHistory();
  analyze();
};
